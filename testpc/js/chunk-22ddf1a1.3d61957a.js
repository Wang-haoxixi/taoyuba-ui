(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22ddf1a1"],{"20d6":function(e,t,n){"use strict";var r=n("5ca1"),a=n("0a49")(6),i="findIndex",o=!0;i in[]&&Array(1)[i](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(i)},"2f9e":function(e,t,n){"use strict";n.d(t,"a",function(){return a});n("ac6a"),n("28a5"),n("a481");var r=n("b5c6");function a(e){var t=e.url,n=e.method,a=void 0===n?"post":n,o=e.data,s=void 0===o?{}:o,c=e.title,l=void 0===c?"":c;return console.log(t),new Promise(function(e){return Object(r["a"])({url:t,method:a,headers:{responseType:"arraybuffer"},data:s,responseType:"blob"}).then(function(t){i({title:l,response:t}).then(function(){e()})})})}function i(e){var t=e.title,n=void 0===t?"":t,r=e.response,a=o(r.headers["content-disposition"].replace(/"/g,""));return new Promise(function(e){var t=r.headers,i=new Blob([r.data],{type:t["content-type"]});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,n);else{var o=document.createElement("a");o.href=window.URL.createObjectURL(i),o.download=n?"".concat(n,".").concat(a.suffix):a.filename,document.body.appendChild(o),o.style.display="none",o.click()}e()})}function o(e){var t={},n=e.split(";");return n.forEach(function(e){var n=e.replace(/^\s+|\s+$/g,""),r=n.split("=");r[1]?t[r[0]]=r[1]:t[r[0]]=r[0]}),t.suffix=t.filename.split(".")[1],t}},3490:function(e,t,n){"use strict";n.d(t,"d",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"e",function(){return s}),n.d(t,"h",function(){return c}),n.d(t,"i",function(){return l}),n.d(t,"a",function(){return u}),n.d(t,"f",function(){return p}),n.d(t,"b",function(){return d}),n.d(t,"g",function(){return m});n("28a5");var r=n("b5c6"),a="/tmlms/relationship";function i(e){return Object(r["a"])({url:"".concat(a,"/getPage"),method:"get",params:e})}function o(e){return Object(r["a"])({url:"".concat(a,"/countRecord"),method:"get",params:e})}function s(e){return Object(r["a"])({url:"".concat(a,"/").concat(e),method:"get"})}function c(e){return Object(r["a"])({url:"".concat(a,"/remove"),method:"post",params:e})}function l(e){return Object(r["a"])({url:"".concat(a,"/edit"),method:"post",data:e})}function u(e){return Object(r["a"])({url:"".concat(a,"/create"),method:"post",data:e})}function p(e){return Object(r["a"])({url:"".concat(a,"/getLast"),method:"get",params:e})}function d(e){return new Promise(function(t,n){Object(r["a"])({url:"",method:"post",data:e,responseType:"arraybuffer"}).then(function(e){var n=e.headers["content-disposition"].split(";")[1];n=decodeURIComponent(n.split("=")[1]);var r=new Blob([e.data]),a=document.createElement("a");a.href=window.URL.createObjectURL(r),a.download=n,document.body.appendChild(a),a.style.display="none",a.click(),t()}).catch(function(){n()})})}function m(e){return Object(r["a"])({url:"/tmlms/statistic/relationRecordByDay",method:"get",params:e})}},7981:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("basic-container",[n("page-header",{attrs:{title:e.title,backOption:e.backOption}}),n("edit-form",{ref:"editForm",attrs:{status:e.status},on:{end:e.onGoBack}}),"detail"!==e.status?n("operation-wrapper",[n("iep-button",{staticStyle:{"margin-left":"150px"},attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保存")])],1):e._e()],1)},a=[],i=n("e0ea"),o=n("84df"),s={props:{status:String,id:String},components:{editForm:i["default"]},data:function(){var e=this;return{backOption:{isBack:!0,backPath:null,backFunction:function(){e.onGoBack()}}}},computed:{title:function(){return"add"===this.status?"新增联系记录":"detail"===this.status?"联系记录详情":"update"===this.status?"编辑联系记录":"联系记录"}},methods:{open:function(e){e&&this.$refs.editForm.getList(e),"add"===this.status&&this.$set(this.$refs.editForm.form,"relationshipTime",Object(o["a"])())},onGoBack:function(){this.$emit("go-back")},handleSubmit:function(){this.$refs.editForm.handleSubmit()}}},c=s,l=n("0c7c"),u=Object(l["a"])(c,r,a,!1,null,"29748a4d",null);t["default"]=u.exports},"84df":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n("c1df"),a=n.n(r),i=function(){return a()().format("YYYY-MM-DD HH:mm:ss")}},ade3:function(e,t,n){"use strict";n.d(t,"p",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"k",function(){return c}),n.d(t,"b",function(){return l}),n.d(t,"m",function(){return u}),n.d(t,"o",function(){return p}),n.d(t,"d",function(){return d}),n.d(t,"w",function(){return m}),n.d(t,"e",function(){return f}),n.d(t,"l",function(){return h}),n.d(t,"q",function(){return b}),n.d(t,"r",function(){return g}),n.d(t,"j",function(){return v}),n.d(t,"n",function(){return y}),n.d(t,"s",function(){return w}),n.d(t,"g",function(){return O}),n.d(t,"h",function(){return N}),n.d(t,"i",function(){return j}),n.d(t,"f",function(){return x}),n.d(t,"u",function(){return k}),n.d(t,"v",function(){return I}),n.d(t,"a",function(){return T}),n.d(t,"t",function(){return S});var r=n("b5c6"),a=n("2f9e"),i="/tybship/tybship";function o(e){return Object(r["a"])({url:"".concat(i,"/otherpage"),method:"get",params:e})}function s(e,t){return Object(r["a"])({url:"".concat(i,"/updateVillage?shipId=").concat(e,"&&villageId=").concat(t),method:"post"})}function c(e,t){return Object(r["a"])({url:"".concat(i,"/getFixOrgIds?shipId=").concat(e,"&&orgId=").concat(t),method:"get"})}function l(e,t){return Object(r["a"])({url:"".concat(i,"/updateOrgId?shipId=").concat(e,"&&orgId=").concat(t),method:"post"})}function u(e){return Object(r["a"])({url:"".concat(i,"/").concat(e),method:"get",params:e})}function p(e){return Object(r["a"])({url:"".concat(i,"/").concat(e),method:"get"})}function d(e){return Object(r["a"])({url:"".concat(i,"/save"),method:"post",data:e})}function m(e){return Object(r["a"])({url:"".concat(i,"/update"),method:"post",data:e})}function f(e){return Object(r["a"])({url:"".concat(i,"/del/").concat(e),method:"post"})}function h(e){return Object(r["a"])({url:"".concat(i,"/mypage"),method:"get",params:e})}function b(e){return Object(r["a"])({url:"".concat(i,"/findship/").concat(e),method:"get"})}function g(e){return Object(r["a"])({url:"".concat(i,"/findshipWithOutOrg/").concat(e),method:"get"})}function v(e){return Object(r["a"])({url:"".concat(i,"/findmyship/").concat(e),method:"get"})}function y(e){return Object(r["a"])({url:"".concat(i,"/searchByshipNo"),method:"get",params:{shipNo:e}})}function w(e){return Object(r["a"])({url:"".concat(i,"/newpage"),method:"get",params:e})}function O(e){return Object(a["a"])({url:"tybship/tybshipExcelExport/downShipInfo",data:e,title:"渔船信息"})}function N(e){return Object(a["a"])({url:"tmlms/tybmlmsExcelExport/downShipCrew",data:e,title:e.shipName})}function j(e){return Object(a["a"])({url:"tmlms/tybmlmsExcelExport/downShipCrewTwoOld ",data:e,title:e.shipName})}function x(e){return Object(a["a"])({url:"tmlms/tybmlmsExcelExport/downContractModel",data:e,title:e.shipName})}function k(e){return Object(r["a"])({url:"tmlms/tyb_order/page",method:"get",params:e})}function I(e){return Object(r["a"])({url:"tmlms/tyb_order/getById",method:"get",params:e})}function T(e){return Object(r["a"])({url:"tmlms/tyb_order/agree",method:"post",data:e})}function S(e){return Object(r["a"])({url:"tmlms/tyb_order/reject",method:"post",data:e})}},cec6:function(e,t,n){"use strict";t["a"]={relationshipReason:[{label:"A",value:"1"},{label:"B",value:"2"}],relationshipType:[{label:"手机",value:1},{label:"座机",value:2},{label:"微信",value:3},{label:"其他",value:4}]}},e0ea:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"150px",disabled:"detail"===e.status}},[n("el-row",[n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:"渔船名",prop:"shipName"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"",filterable:"",remote:"",disabled:e.shipNameDisabled,maxlength:"20","remote-method":e.getShipNameList},on:{change:e.onChange},model:{value:e.form.shipName,callback:function(t){e.$set(e.form,"shipName",t)},expression:"form.shipName"}},e._l(e.shipNames,function(e){return n("el-option",{key:e.shipId,attrs:{label:e.shipName,value:e.shipName}})}),1)],1)],1),n("el-col",{attrs:{span:e.span}},[n("el-form-item",{attrs:{label:"联系人",prop:"shipownerName"}},[n("el-input",{model:{value:e.form.shipownerName,callback:function(t){e.$set(e.form,"shipownerName","string"===typeof t?t.trim():t)},expression:"form.shipownerName"}})],1)],1),n("el-col",{attrs:{span:e.span}},[n("el-form-item",{attrs:{label:"手机号",prop:"shipownerPhone"}},[n("el-input",{attrs:{type:"number"},model:{value:e.form.shipownerPhone,callback:function(t){e.$set(e.form,"shipownerPhone","string"===typeof t?t.trim():t)},expression:"form.shipownerPhone"}})],1)],1),n("el-col",{attrs:{span:e.span}},[n("el-form-item",{attrs:{label:"联系设备",prop:"relationshipType"}},[n("el-select",{attrs:{placeholder:""},model:{value:e.form.relationshipType,callback:function(t){e.$set(e.form,"relationshipType",t)},expression:"form.relationshipType"}},e._l(e.map.relationshipType,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),n("el-col",{attrs:{span:e.span}},[3!==e.form.relationshipType?n("el-form-item",{attrs:{label:"联系号码",prop:"relationshipNumber"}},[n("el-input",{model:{value:e.form.relationshipNumber,callback:function(t){e.$set(e.form,"relationshipNumber","string"===typeof t?t.trim():t)},expression:"form.relationshipNumber"}})],1):e._e()],1),n("el-col",{attrs:{span:e.span}},[n("el-form-item",{attrs:{label:"联系事由",prop:"relationshipReason"}},[n("el-input",{attrs:{maxlength:"50"},model:{value:e.form.relationshipReason,callback:function(t){e.$set(e.form,"relationshipReason","string"===typeof t?t.trim():t)},expression:"form.relationshipReason"}})],1)],1),n("el-col",{attrs:{span:e.span}},[n("el-form-item",{attrs:{label:"联系时间",prop:"relationshipTime"}},[n("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"",align:"right"},model:{value:e.form.relationshipTime,callback:function(t){e.$set(e.form,"relationshipTime",t)},expression:"form.relationshipTime"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:"附件"}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:"/api/admin/file/upload/avatar","on-success":e.handleSuccess,"on-remove":e.handleRemove,"before-upload":e.handleBeforeUpload,"file-list":e.fileList,"on-preview":e.handlePictureCardPreview,multiple:"",headers:e.headers,"list-type":"picture-card"}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s("只能上传图片文件，且不超过4M"))])],1)],1)],1)],1),n("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":"",width:"820px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",{staticStyle:{"text-align":"center"}},[n("img",{staticStyle:{"max-width":"780px"},attrs:{src:e.dialogImageUrl,alt:""}})])])],1)},a=[],i=(n("96cf"),n("3b8d")),o=(n("20d6"),n("ac6a"),n("cebc")),s=(n("c5f6"),n("3490")),c=n("ade3"),l=n("2f62"),u=n("0644"),p=n.n(u),d=n("cec6"),m={props:{status:String,value:{type:Object,default:function(){return{shipName:""}}},span:{type:Number,dafault:24},shipNameDisabled:{type:Boolean,dafault:!1}},data:function(){return{dialogImageUrl:"",dialogVisible:!1,map:d["a"],form:{shipownerName:"",shipownerPhone:"",relationshipType:"",files:[]},fileList:[],shipNames:[],pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}]},rules:{shipName:[{required:!0,message:"请输入渔船名",trigger:["change","blur"]}],shipownerName:[{required:!0,message:"请输入联系人",trigger:"blur"}],shipownerPhone:[{required:!0,message:"请输入手机号",trigger:"blur"}],relationshipType:[{required:!0,message:"请选择联系设备",trigger:"change"}],relationshipNumber:[{required:!0,message:"请输入联系号码",trigger:"blur"}],relationshipReason:[{required:!0,message:"请选择联系事由",trigger:"blur"}],relationshipTime:[{required:!0,message:"请选择联系时间",trigger:"change"}]}}},computed:Object(o["a"])({},Object(l["c"])(["dictGroup","access_token"]),{headers:function(){return{Authorization:"Bearer "+this.access_token}}}),watch:{"form.relationshipType":{handler:function(e){this.getShipNameLastInfo(),3===e&&(this.form.relationshipNumber="")}},"form.shipName":{handler:function(){this.getShipNameLastInfo()}},value:{handler:function(e){this.form.shipName=e.shipName||"",this.form.shipownerName=e.shipownerName||"",this.form.shipownerPhone=e.shipownerPhone||"",this.getShipNameLastInfo()},deep:!0,immediate:!0}},methods:{handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleSuccess:function(e,t,n){var r=p()(this.form.files);Array.isArray(this.form.files)||(this.form.files=[]),n.forEach(function(e){var t={name:"",url:e.response?e.response.data.url:""};""!==t.url&&-1===r.findIndex(function(e){return e.url===t.url})&&r.push(t)}),this.form.files=r},handleRemove:function(e){var t=e.url,n=this.form.files.findIndex(function(e){return e.url===t});n>-1&&this.form.files.splice(n,1)},handleBeforeUpload:function(e){var t=e.size/1024/1024<4;return t||this.$message.error("上传图片大小不能超过4MB"),t},getShipNameLastInfo:function(){var e=this;this.form.shipName&&this.form.relationshipType&&"detail"!==this.status&&Object(s["f"])({shipName:this.form.shipName,relationshipType:this.form.relationshipType}).then(function(t){var n=t.data;0===n.code&&n.data&&e.form.relationshipType===n.data.relationshipType&&e.$set(e.form,"relationshipNumber",n.data.relationshipNumber)})},getShipNameList:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(5!==t.length){e.next=12;break}return e.prev=1,e.next=4,Object(c["q"])(t);case 4:n=e.sent,r=n.data,0===r.code&&(this.shipNames=r.data),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.$message({message:e.t0||"数据查询失败",type:"warning"});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));function t(t){return e.apply(this,arguments)}return t}(),onChange:function(e){var t=this.shipNames.filter(function(t){return t.shipName===e});console.log("data",t,e),t&&t.length>0?(this.$set(this.form,"shipownerName",t[0].shipowner),this.$set(this.form,"shipownerPhone",t[0].mobile),console.log("this.form",this.form)):(this.form.shipownerName="",this.form.shipownerPhone="")},getList:function(e){var t=this;Object(s["e"])(e).then(function(e){var n=e.data;if(0===n.code){var r=n.data,a=[];null==r.relationshipImages&&(r.relationshipImages=[]),r.relationshipImages.forEach(function(e){var t={name:"",url:e};a.push(t)}),t.fileList=a,r.files=a,t.form=r,console.log("result",r)}})},handleSubmit:function(){var e=this;this.$refs["ruleForm"].validate(function(t){if(t){var n="add"===e.status?s["a"]:"update"===e.status?s["i"]:null;n&&(e.form.relationshipImages=e.form.files.map(function(e){return e.url})||[],n(e.form).then(function(t){var n=t.data;0===n.code&&(e.$notify({message:"add"===e.status?"新增成功":"编辑成功",type:"success"}),e.$emit("end"))}))}})}}},f=m,h=n("0c7c"),b=Object(h["a"])(f,r,a,!1,null,"397293ac",null);t["default"]=b.exports}}]);