(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49e3756a"],{"20d6":function(e,t,r){"use strict";var _=r("5ca1"),a=r("0a49")(6),n="findIndex",o=!0;n in[]&&Array(1)[n]((function(){o=!1})),_(_.P+_.F*o,"Array",{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),r("9c6c")(n)},"2f9e":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r("ac6a"),r("28a5"),r("a481");var _=r("b5c6");function a(e){var t=e.url,r=e.method,a=void 0===r?"post":r,o=e.data,i=void 0===o?{}:o,c=e.title,s=void 0===c?"":c;return console.log(t),new Promise((function(e){return Object(_["a"])({url:t,method:a,headers:{responseType:"arraybuffer"},data:i,responseType:"blob"}).then((function(t){n({title:s,response:t}).then((function(){e()}))}))}))}function n(e){var t=e.title,r=void 0===t?"":t,_=e.response,a=o(_.headers["content-disposition"].replace(/"/g,""));return new Promise((function(e){var t=_.headers,n=new Blob([_.data],{type:t["content-type"]});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,r);else{var o=document.createElement("a");o.href=window.URL.createObjectURL(n),o.download=r?"".concat(r,".").concat(a.suffix):a.filename,document.body.appendChild(o),o.style.display="none",o.click()}e()}))}function o(e){var t={},r=e.split(";");return r.forEach((function(e){var r=e.replace(/^\s+|\s+$/g,""),_=r.split("=");_[1]?t[_[0]]=_[1]:t[_[0]]=_[0]})),t.suffix=t.filename.split(".")[1],t}},"393d":function(e,t,r){"use strict";r.r(t);var _=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"agent-add"},[r("basic-container",[e.$route.query.userId?e._e():r("h1",[e._v("\n          "+e._s(e.$route.query.shipName)+"上船登记")]),r("el-form",{ref:"userInfoForm",attrs:{model:e.form,rules:e.userRule,disabled:!1,"label-width":"150px",size:"small"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"个人姓名：",prop:"realName"}},[r("el-input",{model:{value:e.form.realName,callback:function(t){e.$set(e.form,"realName",t)},expression:"form.realName"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"身份证号码：",prop:"idcard"}},[r("el-input",{on:{blur:e.getidcardList},model:{value:e.form.idcard,callback:function(t){e.$set(e.form,"idcard",t)},expression:"form.idcard"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"地址：",prop:"address"}},[r("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1)],1),r("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addUserInfo}},[e._v("添加")])],1)],1)],1),r("el-table",{attrs:{loading:e.tableLoading,data:e.crewList}},[r("el-table-column",{attrs:{prop:"realName",label:"姓名"}}),r("el-table-column",{attrs:{prop:"idcard",label:"身份证"}}),r("el-table-column",{attrs:{prop:"address",label:"地址",width:"300"}}),r("el-table-column",{attrs:{prop:"operation",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("operation-wrapper",[r("iep-button",{attrs:{size:"mini",plain:""},on:{click:function(r){return e.handleDelete(t.row.idcard)}}},[e._v("删除")])],1)]}}])})],1),r("div",{staticStyle:{"text-align":"center","margin-top":"40px"}},[r("el-button",{attrs:{loading:e.saveBtnLoading},on:{click:e.save}},[e._v("提交")]),r("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")])],1)],1)],1)},a=[],n=r("ed4e"),o=n["a"],i=(r("8fcc"),r("2877")),c=Object(i["a"])(o,_,a,!1,null,null,null);t["default"]=c.exports},4525:function(e,t,r){"use strict";r.d(t,"h",(function(){return n})),r.d(t,"i",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return c})),r.d(t,"f",(function(){return s})),r.d(t,"e",(function(){return d})),r.d(t,"c",(function(){return u})),r.d(t,"g",(function(){return l})),r.d(t,"a",(function(){return m}));var _=r("b5c6"),a="tmlms/crew_cert";function n(e){return Object(_["a"])({url:"".concat(a,"/create"),method:"post",data:e})}function o(e){return Object(_["a"])({url:"".concat(a,"/edit"),method:"post",data:e})}function i(e){return Object(_["a"])({url:"".concat(a,"/remove"),method:"post",params:{certId:e}})}function c(e){return Object(_["a"])({url:"".concat(a,"/detail"),method:"get",params:{certId:e}})}function s(e){return Object(_["a"])({url:"".concat(a,"/myCerts"),method:"get",params:{userId:e}})}function d(e,t){return Object(_["a"])({url:"".concat(a,"/getPage"),method:"get",params:e,data:t})}function u(e){return Object(_["a"])({url:"".concat(a,"/")+e,method:"post",data:e})}function l(e){return Object(_["a"])({url:"".concat(a,"/mycertlist"),method:"get",params:{idcard:e}})}function m(e){return Object(_["a"])({url:"".concat(a,"/certStandard/")+e,method:"get"})}},5612:function(e,t,r){"use strict";r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return i})),r.d(t,"l",(function(){return c})),r.d(t,"m",(function(){return s})),r.d(t,"r",(function(){return d})),r.d(t,"c",(function(){return u})),r.d(t,"t",(function(){return l})),r.d(t,"u",(function(){return m})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return p})),r.d(t,"g",(function(){return h})),r.d(t,"v",(function(){return b})),r.d(t,"f",(function(){return E})),r.d(t,"z",(function(){return O})),r.d(t,"k",(function(){return g})),r.d(t,"n",(function(){return P})),r.d(t,"h",(function(){return D})),r.d(t,"p",(function(){return M})),r.d(t,"x",(function(){return y})),r.d(t,"y",(function(){return I})),r.d(t,"w",(function(){return w})),r.d(t,"b",(function(){return v})),r.d(t,"q",(function(){return L})),r.d(t,"a",(function(){return j})),r.d(t,"s",(function(){return C})),r.d(t,"o",(function(){return B}));var _=r("b5c6"),a=r("2f9e"),n="/tmlms/crew";function o(e){return Object(_["a"])({url:"".concat(n,"/Page"),method:"get",params:e})}function i(e){return Object(_["a"])({url:"".concat(n,"/findByShipId?shipId=").concat(e),method:"get",params:e})}function c(e){return Object(_["a"])({url:"".concat(n,"/getHistoryByShipId?shipId=").concat(e.shipId),method:"get",params:e})}function s(e){return Object(_["a"])({url:"".concat(n,"/pageWithShip"),method:"get",params:e})}function d(e){return Object(_["a"])({url:"".concat(n,"/shipLogPage"),method:"get",params:e})}function u(e){return Object(_["a"])({url:"".concat(n,"/checkMoreRelations"),method:"post",data:e})}function l(e,t){return Object(_["a"])({url:"".concat(n,"/create?type=").concat(t),method:"post",data:e})}function m(e,t){return Object(_["a"])({url:"".concat(n,"/batchCreate?type=").concat(t),method:"post",data:e,timeout:3e5})}function f(e){return Object(_["a"])({url:"".concat(n,"/delete?idcard=").concat(e),method:"post"})}function p(e,t){return Object(_["a"])({url:"".concat(n,"/deleteRelation?idcard=").concat(e,"&&shipId=").concat(t),method:"post"})}function h(e,t){return Object(_["a"])({url:"".concat(n,"/edit?type=").concat(t),method:"post",data:e})}function b(e,t){return Object(_["a"])({url:"".concat(n,"/review?status=").concat(e,"&userId=").concat(t),method:"post"})}function E(e){return Object(_["a"])({url:"".concat(n,"/getCrewByidcard?idcard=").concat(e),method:"get"})}function O(e){return Object(_["a"])({url:"admin/file/upload/avatar",method:"post",data:e})}function g(e){return Object(_["a"])({url:"".concat(n,"/idcardcheck?idcard=").concat(e),method:"get"})}function P(e){return Object(_["a"])({url:"".concat(n,"/idcardcheck?idcard=").concat(e),method:"get"})}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"船员信息";return Object(a["a"])({url:"tmlms/tybmlmsExcelExport/downloadCrew",data:e,title:t})}function M(e){return Object(_["a"])({url:"".concat(n,"/badPage"),method:"get",params:e})}function y(e){return Object(_["a"])({url:"".concat(n,"/badUpdateBatch"),method:"post",data:e})}function I(e){return Object(_["a"])({url:"".concat(n,"/uploadBaseImage"),method:"post",data:e})}function w(e){return Object(_["a"])({url:"".concat(n,"/updateCertByIdcard"),method:"post",params:e})}function v(e){return Object(_["a"])({url:"".concat(n,"/changeShip"),method:"post",data:e})}function L(e){return Object(_["a"])({url:"".concat(n,"/getShipRelationByIdcard"),method:"get",params:e})}function j(e){return Object(_["a"])({url:"/tmlms/tybship/pageForChange",method:"get",params:e})}function C(e){return Object(_["a"])({url:"/tmlms/importTask/lookTask",method:"get",params:{taksId:e}})}function B(e){return Object(_["a"])({url:"/tmlms/crew_cert/newPage",method:"get",params:e})}},"8fcc":function(e,t,r){"use strict";r("cffc")},b440:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var _=r("b5c6"),a="/tybhrms/databuspayload";function n(e){return Object(_["a"])({url:"".concat(a,"/getlast"),method:"get",params:e})}},c533b:function(e,t,r){"use strict";r.d(t,"i",(function(){return i})),r.d(t,"f",(function(){return c})),r.d(t,"d",(function(){return s})),r.d(t,"g",(function(){return d})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return l})),r.d(t,"e",(function(){return m})),r.d(t,"j",(function(){return f})),r.d(t,"h",(function(){return p})),r.d(t,"b",(function(){return h}));var _=r("b5c6"),a="tmlms/crew",n="admin/region",o="admin/dict";function i(e){return Object(_["a"])({url:"".concat(n,"/getinfo/")+e,method:"get"})}function c(e){return Object(_["a"])({url:"".concat(o,"/type/")+e,method:"get"})}function s(e){return Object(_["a"])({url:"".concat(n,"/area"),method:"get",params:{parentCode:e}})}function d(e){return Object(_["a"])({url:"".concat(a,"/Page"),method:"get",params:e})}function u(e){return Object(_["a"])({url:"".concat(a,"/delete"),method:"post",params:{userId:e}})}function l(e){return Object(_["a"])({url:"".concat(a,"/create"),method:"post",data:e,params:{type:1}})}function m(e){return Object(_["a"])({url:"".concat(a,"/getCrewByUserId"),method:"get",params:{userId:e}})}function f(e){return Object(_["a"])({url:"".concat(a,"/edit"),method:"post",params:{type:1},data:e})}function p(e){return Object(_["a"])({url:"/tybship/tybregion/parent/".concat(e),method:"get"})}function h(e,t,r){return Object(_["a"])({url:"".concat(a,"/upWork?idcard=").concat(t,"&workStatus=").concat(r),method:"post",data:e})}},cffc:function(e,t,r){},e420:function(e,t,r){"use strict";r("7f7f");var _=r("7ded");t["a"]={data:function(){return{haveInfo:{}}},methods:{getInformation:function(e,t){var r=this;Object(_["c"])().then((function(_){-1===_.data.data.roles.indexOf(1)&&-1===_.data.data.roles.indexOf(111)&&(_.data.data.sysUser.phone&&(r.$set(r.haveInfo,"phone",!0),r[e][t[0]]=_.data.data.sysUser.phone),_.data.data.sysUser.realName&&(r.$set(r.haveInfo,"realName",!0),r[e][t[1]]=_.data.data.sysUser.realName),_.data.data.sysUser.idCard&&[t[2]]&&(r.$set(r.haveInfo,"idcard",!0),r[e].idcard=_.data.data.sysUser.idCard))}))}}}},e9bd:function(e,t,r){"use strict";r.d(t,"a",(function(){return _}));var _=[{prop:"certNo",label:"证书编码"},{prop:"certType",label:"证书类型",type:"dict",dictName:"tyb_crew_cert_type"},{prop:"certLevel",label:"证书等级",type:"dict",dictName:"tyb_crew_cert_level"},{prop:"certTitle",label:"证书职务",type:"dict",dictName:"tyb_crew_cert_title"},{prop:"certDateIssue",label:"有效期至",type:"date"},{prop:"certDateExpire",label:"结束日期",type:"date"},{prop:"annex",label:"扫描件",type:"file"}]},ed4e:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("8e6e"),core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es7_object_get_own_property_descriptors__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("456d"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_1__),E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("ade3"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("6762"),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("2fdb"),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_5__),E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("53ca"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("6b54"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_typed_uint8_array__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("34ef"),core_js_modules_es6_typed_uint8_array__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_typed_uint8_array__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_9__),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_10__),E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("1da1"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("7f7f"),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("20d6"),core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es6_array_find_index__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("4917"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_15__),_api_post_admin__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("c533b"),_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("5612"),_api_hrms_databuspayload__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("b440"),_views_hrms_ComponentsNew_options__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("e9bd"),_api_login__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("7ded"),_api_post_cert__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("4525"),_mixins_information__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("e420"),_store__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("4360"),lodash_debounce__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("b047"),lodash_debounce__WEBPACK_IMPORTED_MODULE_24___default=__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_24__),vue_socket_io__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("5132"),vue_socket_io__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(vue_socket_io__WEBPACK_IMPORTED_MODULE_25__),vue__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("2b0e"),vuex__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("2f62");function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);t&&(_=_.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,_)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){Object(E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}vue__WEBPACK_IMPORTED_MODULE_26__["default"].use(new vue_socket_io__WEBPACK_IMPORTED_MODULE_25___default.a({debug:!1,connection:"http://localhost:5000"})),__webpack_exports__["a"]={mixins:[_mixins_information__WEBPACK_IMPORTED_MODULE_22__["a"]],data:function(){this.getidcardList=lodash_debounce__WEBPACK_IMPORTED_MODULE_24___default()(this.getidcardList,800);var e=function(e,t,r){""===t?r(new Error("请输入联系电话")):t.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[0-9]|19[0-9]|16[0-9])[0-9]{8}$/)?r():r(new Error("请输入正确的手机号码!"))},t=function(e,t,r){""===t?r(new Error("请填写身份证信息")):t.match(/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/)?r():r(new Error("身份证号码不正确"))};return{certificateColumns:_views_hrms_ComponentsNew_options__WEBPACK_IMPORTED_MODULE_19__["a"],saveBtnLoading:!1,tableLoading:!1,form:{address:"",idcard:"",realName:"",birthday:"",nation:"",gender:1,districtId:"",cityId:""},crewList:[],agent:{businessLicense:""},position:[],province:[],city:[],district:[],rules:{realName:[{required:!0,message:"请填写个人姓名",trigger:"blur"}],contactName:[{required:!0,message:"请填联系人",trigger:"blur"}],gender:[{required:!0,message:"请填写性别",trigger:"blur"}],idcard:[{required:!0,message:"请填写身份证信息",trigger:"blur"}],birthday:[{required:!0,message:"请填写生日信息",trigger:"blur"}],nationality:[{required:!0,message:"请填写国籍",trigger:"blur"}],contactPhone:[{required:!0,message:"请填写联系电话",trigger:"blur"}],positionId:[{required:!0,message:"请填写职位",trigger:"blur"}],applyType:[{required:!0,message:"请填写申请类别",trigger:"blur"}],address:[{required:!0,message:"请填写地址",trigger:"blur"}],phone:[{required:!0,message:"请填写联系电话",trigger:"blur"},{validator:e,trigger:"blur"}]},shipCrewRules:{},options:[],applyTypes:[{id:1,name:"以旧换新"},{id:2,name:"普通船员"},{id:3,name:"职务船员"},{id:4,name:"证书换发"},{id:5,name:"证书补发"},{id:6,name:"其他"}],userRule:{realName:[{required:!0,message:"请填写个人姓名",trigger:"blur"}],idcard:[{required:!0,message:"请填写身份证信息",trigger:"blur"},{validator:t,trigger:"blur"}],address:[{required:!0,message:"请填写地址",trigger:"blur"}]},dataLoad:[],sn:"",manager:!1,headers:{Authorization:"Bearer "+_store__WEBPACK_IMPORTED_MODULE_23__["a"].getters.access_token},isIdcard:!1,idx:"",loading:!1,idcards:[],isShipCrew:!1}},methods:{getidcardList:function(e){var t=this;console.log(e);var r=e.target.value||"";if(18===r.length)return/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(r)?void Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["k"])(r).then((function(e){if(0===e.data.data.userId||!0===e.data.data)return t.form.realName=e.data.data.realName,void(t.form.address=e.data.data.address)})):(this.$message({message:"身份证号码不正确",type:"warning"}),void(this.form.idcard=""))},addUserInfo:function(){var e=this;this.$refs.userInfoForm.validate((function(t){if(!t)return!1;var r=e.crewList.findIndex((function(t){return t.idcard===e.form.idcard}));if(r>=0)return e.$message({message:"该身份已存在",type:"warning"}),!1;e.form.nationality="中国",e.form.gender=1,e.form.shipId=e.$route.params.shipId,e.form.flag=1,e.form.birthday=e.form.idcard.slice(6,10)+"-"+e.form.idcard.slice(10,12)+"-"+e.form.idcard.slice(12,14),e.crewList.push(Object.assign({},e.form)),e.form.realName="",e.form.idcard="",e.form.address="",e.form.nationality="",e.form.gender="",e.form.birthday=""}))},handleDelete:function(e){this.crewList=this.crewList.filter((function(t){if(t.idcard!==e)return t}))},save:function(){var e=this,t=1;console.log(this.crewList),this.crewList&&this.$confirm("提交之后将无法修改, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.saveBtnLoading=!0,Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["c"])(e.crewList).then((function(r){console.log("三艘船"),r.data.data?(e.crewList.forEach((function(e){e.sourceType=2})),Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["u"])(e.crewList,t).then((function(t){console.log(t),e.$message.success("船员批量添加成功!"),e.$router.go(-1),e.saveBtnLoading=!1})).catch((function(){e.saveBtnLoading=!1}))):(e.$message({message:r.data.msg||"船员批量添加失败!",type:"warning"}),e.saveBtnLoading=!1)})).catch((function(t){e.$message.error(t.message),e.saveBtnLoading=!1}))}))},choseProvince:function(e){var t=this;this.form.cityId="",this.form.districtId="",this.district=[],Object(_api_post_admin__WEBPACK_IMPORTED_MODULE_16__["d"])(e).then((function(e){var r=e.data;t.city=r.data}))},setData:function(e){this.form.certList=e},choseCity:function(e){var t=this;Object(_api_post_admin__WEBPACK_IMPORTED_MODULE_16__["d"])(e).then((function(e){var r=e.data;t.district=r.data}))},handleSave:function(){},collect:function(){var e=this;this.sn="",Object(_api_hrms_databuspayload__WEBPACK_IMPORTED_MODULE_18__["a"])({sn:this.sn}).then((function(t){Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["k"])(t.data.data.identityNumber).then((function(r){!0!==r.data.data?(e.choseProvince(r.data.data.provinceId),e.choseCity(r.data.data.cityId),e.form=r.data.data,e.$set(e.form,"idcardPhoto","data:image/png;base64,"+t.data.data.photo),e.$set(e.form,"facePhoto","data:image/png;base64,"+t.data.data.picture),e.$set(e.form,"certList",[]),e.isIdcard=!0,Object(_api_post_cert__WEBPACK_IMPORTED_MODULE_21__["g"])(t.data.data.identityNumber).then((function(t){t.data.data.forEach((function(t){if(e.form.certList.push(t),e.form.certList){var r=0;e.form.certList.forEach((function(e){e.id=r,r++}))}}))}))):0===t.data.code&&(e.form.address=t.data.data.address,e.form.idcard=t.data.data.identityNumber,e.form.realName=t.data.data.name,e.form.nation=t.data.data.nation,e.$set(e.form,"idcardPhoto","data:image/png;base64,"+t.data.data.photo),e.$set(e.form,"facePhoto","data:image/png;base64,"+t.data.data.picture))}))})).catch((function(t){e.$message.error(t.message)}))},handleAvatarSuccessFront:function(e){this.form.photoFront=e.data.url},handleAvatarSuccessReverse:function(e){this.form.photoReverse=e.data.url},handleAvatarSuccessCert:function(e){this.form.certPhoto=e.data.url},getIdcardFile:function(){var e=Object(E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_11__["a"])(regeneratorRuntime.mark((function e(){var t,r,_=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.dataURLtoFile(this.form.idcardPhoto),r=new FormData,r.append("file",t),e.next=5,Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["z"])(r).then((function(e){return _.form.idcardPhoto=e.data.data.url}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getFaceFile:function(){var e=Object(E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_11__["a"])(regeneratorRuntime.mark((function e(){var t,r,_=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.dataURLtoFile(this.form.facePhoto),r=new FormData,r.append("file",t),e.next=5,Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["z"])(r).then((function(e){return _.form.facePhoto=e.data.data.url}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),dataURLtoFile:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img";console.log(e);var r=e.split(","),_=r[0].match(/:(.*?);/)[1],a=_.split("/")[1],n=atob(r[1]),o=n.length,i=new Uint8Array(o);while(o--)i[o]=n.charCodeAt(o);return new File([i],"".concat(t,".").concat(a),{type:_})},newMember:function(){this.form.certList||this.$set(this.form,"certList",[]);var e=this.form.certList.length;e<2?this.form.certList.push({id:e?(parseInt(this.form.certList[e-1].id)+1).toString():"0"}):this.$message({message:"最多两个证书",type:"warning"})},remove:function(e){var t=this;this.$confirm("此操作将永久删除该证书, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){if(2===t.form.certList.length){var r=t.form.certList.filter((function(t){return t.id!=e}));t.form.certList=r}else if(1===t.form.certList.length){var _=t.form.certList.filter((function(e){return 2==e.id}));t.form.certList=_}t.$message({type:"success",message:"删除成功!"})})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handleAvatarSuccessFile:function(e){this.$set(this.form.certList[this.idx],"certFile",e.data.url)},fileUpload:function(e){this.idx=e},idcardChange:function(e){"object"===Object(E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_typeof__WEBPACK_IMPORTED_MODULE_6__["a"])(e)?this.refreshCard(e):this.refreshCard({idcard:e}),this.idcards=[]},refreshCard:function(e){if(null!==e){var t=e.idcard,r=void 0===t?"":t;this.form.idcard=r}else this.form.idcard=""},getIdCardData:function(){var e=this;return new Promise((function(t){e.$jsonp("http://localhost:8989/api/ReadMsg?cardImg=1").then((function(r){e.form.photoFront=r.frontImg,e.form.photoReverse=r.backImg,t()}))}))}},created:function(){var e=this;function t(){return r.apply(this,arguments)}function r(){return r=Object(E_taoyuba_ui_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_11__["a"])(regeneratorRuntime.mark((function e(){var t,r,_,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(_api_tmlms_boatMan__WEBPACK_IMPORTED_MODULE_17__["f"])(this.$route.query.edit||this.$route.query.see||this.$route.query.idcard).then((function(e){return e.data.data}));case 2:return t=e.sent,e.next=5,this.choseProvince(t.provinceId);case 5:return r=e.sent,e.next=8,this.choseCity(t.cityId);case 8:_=e.sent,console.log(r),console.log(_),t.certList&&(a=0,t.certList.forEach((function(e){e.id=a,a++}))),console.log("编辑数据"),console.log(t),this.form=t;case 15:case"end":return e.stop()}}),e,this)}))),r.apply(this,arguments)}Object(_api_post_admin__WEBPACK_IMPORTED_MODULE_16__["d"])(0).then((function(t){var r=t.data;e.province=r.data})),Object(_api_post_admin__WEBPACK_IMPORTED_MODULE_16__["f"])("tyb_resume_position").then((function(t){var r=t.data;e.position=r.data})),(this.$route.query.edit||this.$route.query.see||this.$route.query.userId)&&t.call(this),Object(_api_login__WEBPACK_IMPORTED_MODULE_20__["c"])().then((function(t){t.data.data.roles.includes(111)?e.manager=!0:e.manager=!1,-1!==t.data.data.roles.indexOf(111)||-1!==t.data.data.roles.indexOf(112)?e.isManger=!1:e.isManger=!0,t.data.data.sysUser.userId}))},beforeDestroy:function(){this.sockets.unsubscribe("card message")},mounted:function mounted(){var _this12=this;function Base64(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.decode=function(r){var _,a,n,o,i,c,s,d="",u=0;r=r.replace(/[^A-Za-z0-9+/=]/g,"");while(u<r.length)o=e.indexOf(r.charAt(u++)),i=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),s=e.indexOf(r.charAt(u++)),_=o<<2|i>>4,a=(15&i)<<4|c>>2,n=(3&c)<<6|s,d+=String.fromCharCode(_),64!=c&&(d+=String.fromCharCode(a)),64!=s&&(d+=String.fromCharCode(n));return d=t(d),d};var t=function(e){var t="",r=0,_=0,a=0,n=0;while(r<e.length)_=e.charCodeAt(r),_<128?(t+=String.fromCharCode(_),r++):_>191&&_<224?(a=e.charCodeAt(r+1),t+=String.fromCharCode((31&_)<<6|63&a),r+=2):(a=e.charCodeAt(r+1),n=e.charCodeAt(r+2),t+=String.fromCharCode((15&_)<<12|(63&a)<<6|63&n),r+=3);return t}}this.$socket.emit("startRead"),this.sockets.subscribe("card message",(function(msg){console.log("card message");var base=new Base64,result1=base.decode(msg),data=eval("("+result1+")");console.log("sockets",data),_this12.getIdCardData().then((function(){var e={},t={},r=!1;_this12.form.idcardPhoto=data.photobase64,data.frontImg&&(_this12.form.photoFront=data.frontImg),data.backImg&&(_this12.form.photoReverse=data.backImg),_this12.form.realName=data.name,_this12.form.birthday=data.born.slice(0,4)+"-"+data.born.slice(4,6)+"-"+data.born.slice(6),_this12.form.idcard=data.cardno,_this12.form.address=data.address,_this12.form.nation=data.nation,_this12.form.gender="男"==data.sex?1:2,_this12.form.nationality="中国",e.provinceId=parseInt(data.cardno.substring(0,2)+"0000000000"),e.cityId=parseInt(data.cardno.substring(0,4)+"00000000"),e.districtId=parseInt(data.cardno.substring(0,6)+"000000"),_this12.choseProvince(e.provinceId),_this12.choseCity(e.cityId),_this12.form.provinceId=e.provinceId,_this12.form.cityId=e.cityId,_this12.form.districtId=e.districtId,_this12.form.shipId=_this12.$route.params.shipId,_this12.form.flag=1,t=JSON.parse(JSON.stringify(_this12.form)),_this12.crewList.length&&_this12.crewList.forEach((function(e){t.idcard==e.idcard&&(r=!0)})),r||_this12.crewList.push(t)}))}))},computed:_objectSpread({type:function(){return this.$route.query.see?1:2}},Object(vuex__WEBPACK_IMPORTED_MODULE_27__["e"])({roles:function(e){return e.user.roles}})),watch:{"form.idcard":{handler:function(e){if(void 0!==e&&18===e.length){var t=e.substr(6,8).replace(/^(\d{4})(\d{2})(\d{2})$/,"$1-$2-$3");this.form.birthday=t}},deep:!0}}}}}]);